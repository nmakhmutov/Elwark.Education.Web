@page "/history/leaderboards/global"
@using Education.Web.Gateways.History.Leaderboards.Model
@using Education.Web.Pages.History.Leaderboards.Overall.Components
@using Education.Web.Gateways.History
@layout HistoryLayout
@attribute [Authorize]

<EduPage ShowFooter="@_response.IsLoaded">
    <EduContainer MaxWidth="EduWidth.W1920" Class="pb-0">
        <PageHeader Title="@L["Leaderboard:Overall:Name"]" Breadcrumbs="@Breadcrumbs"/>
    </EduContainer>

    <ApiViewer Response="@_response" Context="items">
        <EduContainer MaxWidth="EduWidth.W1920" Class="pb-0">
            <EduFitGrid>
                @foreach (var user in items[..3])
                {
                    <RankingCard
                        Rank="@user.Rank"
                        Level="@user.Level"
                        Experience="@user.Experience"
                        Name="@user.Name"
                        Image="@user.Image"/>
                }
            </EduFitGrid>
        </EduContainer>

        <EduContainer MaxWidth="EduWidth.W1920">
            <RankingTable Users="@(items[3..])"/>
        </EduContainer>
    </ApiViewer>
</EduPage>

@code {
    private ApiResponse<OverallRankingModel[]> _response = ApiResponse<OverallRankingModel[]>.Loading();

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["Subject:History"].Value, HistoryLinks.Root)
    };

    [Inject]
    private IHistoryClient Client { get; set; } = default!;

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    protected override async Task OnInitializedAsync() =>
        _response = await Client.Leaderboard.GetOverallAsync();

}
