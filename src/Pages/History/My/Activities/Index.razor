@using Education.Web.Pages.History.My.Activities.Components
@using Education.Web.Services.History.User
@using Education.Web.Services.History.User.Model

@page "/history/my/activities"
@layout HistoryLayout
@attribute [Authorize]

<PageTitle>@L["Test:MyActivity"]</PageTitle>

<EduPage ShowFooter="@_result.IsLoaded">
    <EduContainer MaxWidth="EduWidth.W1920" Class="pb-0">
        <EduPageHeader Title="@L["Test:MyActivity"]" Breadcrumbs="@Breadcrumbs"/>
    </EduContainer>
    <ApiViewer Result="@_result" Context="activity">
        <EduContainer MaxWidth="EduWidth.W1920">
            <div class="grid">
                <TestCard
                    Class="easy-test"
                    Title="@L["Tests:Easy"]"
                    Href="@HistoryUrl.User.MyEasyTests"
                    Value="@activity.EasyTests"/>

                <TestCard
                    Class="hard-test"
                    Title="@L["Tests:Hard"]"
                    Href="@HistoryUrl.User.MyHardTests"
                    Value="@activity.HardTests"/>

                <TestCard
                    Class="mixed-test"
                    Title="@L["Tests:Mixed"]"
                    Href="@HistoryUrl.User.MyMixedTests"
                    Value="@activity.MixedTests"/>

                <TestCard
                    Class="event-guesser"
                    Title="@L["EventGuesser"]"
                    Href="@HistoryUrl.User.MyEventGuessers"
                    Value="@activity.EventGuessers"/>

                <ActivityCard
                    Class="monthly"
                    Title="@L["Statistics:Daily"]"
                    Activities="@activity.Daily"
                    DateFormat="dd MMM"/>

                @if (activity.Monthly.Length > 1)
                {
                    <ActivityCard
                        Class="annual"
                        Title="@L["Statistics:Monthly"]"
                        Activities="@activity.Monthly"
                        DateFormat="MMM yyyy"/>
                }
            </div>
        </EduContainer>
    </ApiViewer>
</EduPage>

@code {

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["Profile"].Value, HistoryUrl.User.MyProfile)
    };

    private ApiResult<ProgressStatisticsModel> _result = ApiResult<ProgressStatisticsModel>.Loading();

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryUserService UserService { get; set; } = default!;

    protected override async Task OnParametersSetAsync() =>
        _result = await UserService.GetProgressAsync();

}
