@using Education.Web.Pages.Account
@using Education.Web.Pages.Authentication

<AuthorizeView>
    <NotAuthorized>
        <MudButton
            Class="ml-3"
            DisableElevation
            Variant="Variant.Filled"
            Color="Color.Primary"
            Size="Size.Small"
            OnClick="@OnLogin">
            @L["Account:SignIn"]
        </MudButton>
    </NotAuthorized>

    <Authorizing>
        <MudSkeleton Class="ml-3" SkeletonType="SkeletonType.Circle" Width="40px" Height="40px"/>
    </Authorizing>

    <Authorized>
        <MudMenu Class="ml-3" OffsetX Dense Direction="Direction.Left">
            <ActivatorContent>
                <MudAvatar Image="@Customer.Image"/>
            </ActivatorContent>

            <ChildContent>
                <section class="mud-paper pa-3 mt-n2">
                    <header class="customer">
                        <MudAvatar Class="mr-3" Image="@Customer.Image"/>
                        <MudText Class="one-line-text" Typo="Typo.body1">
                            @Customer.Name
                        </MudText>
                    </header>
                </section>

                <MudDivider Class="mb-3"/>

                <MudListItem Class="px-3" Text="@L["Account"]" Icon="@Icons.Outlined.Person" Href="@AccountUrl.Root"/>
                <MudListItem Class="px-3 mb-n2" Text="@L["Account:Logout"]" Icon="@Icons.Outlined.Login" OnClick="@OnLogout"/>
            </ChildContent>
        </MudMenu>
    </Authorized>
</AuthorizeView>

@code {

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private SignOutSessionStateManager SignOutManager { get; set; } = default!;

    [Inject]
    private NavigationManager Navigation { get; set; } = default!;

    [CascadingParameter]
    private CustomerState Customer { get; set; } = default!;

    private void OnLogin() =>
        Navigation.NavigateTo(AuthenticationUrl.LogIn(Navigation.Uri));

    private async Task OnLogout(MouseEventArgs args)
    {
        await SignOutManager.SetSignOutState();
        Navigation.NavigateTo(AuthenticationUrl.LogOut);
    }

}