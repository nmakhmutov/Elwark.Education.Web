<section class="mud-paper pa-3 pa-sm-6 @Class">
    <div class="mb-3">
        @if (Activity?.Status != LearningStatus.Unengaged)
        {
            <MudLink Typo="Typo.subtitle2" Href="@HistoryUrl.User.MyArticle(ArticleId)">
                @L["User_MyProgress"]
            </MudLink>
        }
        else
        {
            <MudText Typo="Typo.subtitle2">
                @L["User_MyProgress"]
            </MudText>
        }
    </div>

    @if (HasEasyQuiz)
    {
        <div class="d-flex justify-space-between align-center border-b mud-border-lines-default pb-1 mb-2">
            <MudText Typo="Typo.body1">@L["NumberOfQuizzes_PassedEasy_Title"]</MudText>
            <div class="d-flex align-center gap-1">
                <MudText Typo="Typo.body1">
                    @((Activity?.EasyQuizzes ?? 0).ToMetric())
                </MudText>
                <MudIcon Icon="@EduIcons.Quiz" Size="Size.Small"/>
            </div>
        </div>
    }

    @if (HasHardQuiz)
    {
        <div class="d-flex justify-space-between align-center border-b mud-border-lines-default pb-1 mb-2">
            <MudText Typo="Typo.body1">@L["NumberOfQuizzes_PassedHard_Title"]</MudText>
            <div class="d-flex align-center gap-1">
                <MudText Typo="Typo.body1">
                    @((Activity?.HardQuizzes ?? 0).ToMetric())
                </MudText>
                <MudIcon Icon="@EduIcons.Quiz" Size="Size.Small"/>
            </div>
        </div>
    }

    <div class="d-flex justify-space-between align-center pb-1 mb-2">
        <MudText Typo="Typo.body1">
            @L["LearningStatus_Title"]
        </MudText>

        <ArticleCompletionChip
            Status="@(Activity?.Status ?? LearningStatus.Unengaged)"
            Href="@HistoryUrl.User.MyArticle(ArticleId)"
            Size="Size.Small"/>
    </div>

    <MudText Typo="Typo.body2">
        @if (_hasQuiz)
        {
            @L.GetLearningStatusDescription(Activity?.Status ?? LearningStatus.Unengaged)
        }
        else
        {
            @L["Article_TheArticleDoesNotHaveAnyQuizzesYet"]
        }
    </MudText>

    <div class="mt-3 mt-sm-6">
        @if (_hasQuiz)
        {
            <MudButton
                Link="@HistoryUrl.Quiz.Index(ArticleId)"
                Variant="Variant.Filled"
                Color="Color.Primary"
                FullWidth
                DisableElevation>
                @L["Quiz_TakeTheQuiz"]
            </MudButton>
        }
    </div>
</section>

@code {
    private bool _hasQuiz;

    [Inject]
    private IStringLocalizer<App> L { get; init; } = default!;

    [Parameter, EditorRequired]
    public required string ArticleId { get; set; }

    [Parameter, EditorRequired]
    public required UserArticleActivityModel? Activity { get; set; }

    [Parameter, EditorRequired]
    public required bool HasEasyQuiz { get; set; }

    [Parameter, EditorRequired]
    public required bool HasHardQuiz { get; set; }

    [Parameter]
    public string? Class { get; set; }

    protected override void OnParametersSet() =>
        _hasQuiz = HasEasyQuiz || HasHardQuiz;

}