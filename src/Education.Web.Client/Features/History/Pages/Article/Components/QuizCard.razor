<section class="mud-paper pa-3 pa-sm-6 @Class">
    <div class="mb-3">
        @if (Activity?.IsCompleted is not null)
        {
            <MudLink Typo="Typo.subtitle2" Href="@HistoryUrl.User.MyArticle(ArticleId)">
                @L["User_MyProgress"]
            </MudLink>
        }
        else
        {
            <MudText Typo="Typo.subtitle2">
                @L["User_MyProgress"]
            </MudText>
        }
    </div>

    @if (HasEasyQuiz)
    {
        <div class="d-flex justify-space-between align-center border-b mud-border-lines-default pb-1 mb-2">
            <MudText Typo="Typo.body1">@L["NumberOfQuizzes_PassedEasy_Title"]</MudText>
            <div class="d-flex align-center gap-1">
                <MudText Typo="Typo.body1">
                    @((Activity?.EasyQuizzes ?? 0).ToMetric())
                </MudText>
                <MudIcon Icon="@EduIcons.Quiz" Size="Size.Small"/>
            </div>
        </div>
    }

    @if (HasHardQuiz)
    {
        <div class="d-flex justify-space-between align-center border-b mud-border-lines-default pb-1 mb-2">
            <MudText Typo="Typo.body1">@L["NumberOfQuizzes_PassedHard_Title"]</MudText>
            <div class="d-flex align-center gap-1">
                <MudText Typo="Typo.body1">
                    @((Activity?.HardQuizzes ?? 0).ToMetric())
                </MudText>
                <MudIcon Icon="@EduIcons.Quiz" Size="Size.Small"/>
            </div>
        </div>
    }

    <div class="d-flex justify-space-between align-center pb-1 mb-2">
        <MudText Typo="Typo.body1">@L["LearningStatus_Title"]</MudText>
        <ArticleCompletionChip
            IsCompleted="@Activity?.IsCompleted"
            Href="@HistoryUrl.User.MyArticle(ArticleId)"
            Size="Size.Small"/>
    </div>

    <MudText Typo="Typo.body2">
        @Status
    </MudText>

    <div class="mt-3 mt-sm-6">
        @if (_hasQuiz)
        {
            <MudButton
                Link="@HistoryUrl.Quiz.Index(ArticleId)"
                Variant="Variant.Filled"
                Color="Color.Primary"
                FullWidth
                DisableElevation>
                @L["Quiz_TakeTheQuiz"]
            </MudButton>
        }
    </div>
</section>

@code {
    private bool _hasQuiz;

    private string Status => (_hasQuiz, Activity?.IsCompleted) switch {
        (true, true) => L["LearningStatus_Completed_Description"],
        (true, false) => L["LearningStatus_Incompleted_Description"],
        (true, null) => L["LearningStatus_Unengaged_Description"],
        _ => L["Article_TheArticleDoesNotHaveAnyQuizzesYet"]
        };

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Parameter]
    public string? Class { get; set; }

    [Parameter, EditorRequired]
    public string ArticleId { get; set; } = default!;

    [Parameter, EditorRequired]
    public UserArticleActivityModel? Activity { get; set; }

    [Parameter, EditorRequired]
    public bool HasEasyQuiz { get; set; }

    [Parameter, EditorRequired]
    public bool HasHardQuiz { get; set; }

    protected override void OnParametersSet() =>
        _hasQuiz = HasEasyQuiz || HasHardQuiz;

}