@page "/history/my/article/{id}"
@using Education.Web.Client.Features.History.Services.Learner.Model
@using Education.Web.Client.Features.History.Services.Learner
@layout HistoryLayout
@attribute [Authorize]

<ApiViewer Result="@_result" Context="result">
    <PageTitle>
        @result.Article.Title
    </PageTitle>

    <EduContainer Class="py-3 py-sm-6" MaxWidth="EduWidth.W1280">
        <ArticleOverview
            Class="mb-3 mb-sm-6"
            Article="@result.Article"
            Total="@result.Total"
            IsBookmarked="@result.IsBookmarked"
            IsCompleted="@result.IsCompleted"
            OnBookmarkClick="@LearnerService.ToggleArticleBookmarkAsync"/>

        <MudTabs Elevation="0" PanelClass="pt-6" ApplyEffectsToContainer Rounded>
            <MudTabPanel Text="@L["Quizzes_Easy_Title"]">
                <QuizOverview
                    Quiz="@result.EasyQuiz"
                    SeeAllText="@L["Quizzes_Easy_SeeAll"]"
                    SeeAllHref="@HistoryUrl.User.MyEasyQuizzes"
                    DateTimeFormatter="@Customer.Humanize"/>
            </MudTabPanel>
            <MudTabPanel Text="@L["Quizzes_Hard_Title"]">
                <QuizOverview
                    Quiz="@result.HardQuiz"
                    SeeAllText="@L["Quizzes_Hard_SeeAll"]"
                    SeeAllHref="@HistoryUrl.User.MyHardQuizzes"
                    DateTimeFormatter="@Customer.Humanize"/>
            </MudTabPanel>
        </MudTabs>
    </EduContainer>
</ApiViewer>

@code {
    private ApiResult<ArticleStatisticsModel> _result = ApiResult<ArticleStatisticsModel>.Loading();

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryLearnerService LearnerService { get; set; } = default!;

    [CascadingParameter]
    private CustomerState Customer { get; set; } = default!;

    [Parameter]
    public string Id { get; set; } = string.Empty;

    protected override async Task OnInitializedAsync() =>
        _result = await LearnerService.GetArticlesAsync(Id);

}