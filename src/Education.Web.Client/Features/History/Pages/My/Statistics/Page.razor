@page "/history/my/statistics"
@using Education.Web.Client.Features.History.Services.User.Model
@using Education.Web.Client.Features.History.Services.User
@layout HistoryLayout
@attribute [Authorize]

<PageTitle>
    @L["Statistics"]
</PageTitle>

<EduContainer Class="py-3 py-sm-6" MaxWidth="EduWidth.W1920">
    <EduPageHeader Title="@L["Statistics"]" Breadcrumbs="@Breadcrumbs"/>
</EduContainer>

<ApiViewer Result="@_result" Context="profile">
    <EduContainer Class="pb-3 pb-sm-6" MaxWidth="EduWidth.W1920">
        <EduFillGrid>
            <StatisticsCard
                Title="@L["Shared_QuizzesEasy"]"
                Value="@profile.EasyQuiz.NumberOfQuizzes.Total"
                Href="@HistoryUrl.User.MyEasyQuizzes">
                <Subheader Title="@L["Score"]" Subtitle="@L["ForAllTime"]"/>
                <ScoreChart Value="@profile.EasyQuiz.Score"/>
            </StatisticsCard>

            <StatisticsCard
                Title="@L["Shared_QuizzesHard"]"
                Value="@profile.HardQuiz.NumberOfQuizzes.Total"
                Href="@HistoryUrl.User.MyHardQuizzes">
                <Subheader Title="@L["Score"]" Subtitle="@L["ForAllTime"]"/>
                <ScoreChart Value="@profile.HardQuiz.Score"/>
            </StatisticsCard>

            <StatisticsCard
                Title="@L["History_EventGuessersSmall"]"
                Value="@profile.SmallEventGuesser.Tests"
                Href="@HistoryUrl.User.MySmallEventGuessers">
                <Subheader Title="@L["Score"]" Subtitle="@L["ForAllTime"]"/>
                <EventGuesserScoreChart Score="@profile.SmallEventGuesser.Score"/>
            </StatisticsCard>

            <StatisticsCard
                Title="@L["History_EventGuessersMedium"]"
                Value="@profile.MediumEventGuesser.Tests"
                Href="@HistoryUrl.User.MyMediumEventGuessers">
                <Subheader Title="@L["Score"]" Subtitle="@L["ForAllTime"]"/>
                <EventGuesserScoreChart Score="@profile.MediumEventGuesser.Score"/>
            </StatisticsCard>

            <StatisticsCard
                Title="@L["History_EventGuessersLarge"]"
                Value="@profile.LargeEventGuesser.Tests"
                Href="@HistoryUrl.User.MyLargeEventGuessers">
                <Subheader Title="@L["Score"]" Subtitle="@L["ForAllTime"]"/>
                <EventGuesserScoreChart Score="@profile.LargeEventGuesser.Score"/>
            </StatisticsCard>

            @foreach (var money in profile.Accounting)
            {
                <BudgetCard
                    Title="@L[$"InternalMoney:{money.Currency}"]"
                    Icon="@EduIcons.Silver"
                    Href="@HistoryUrl.User.MySilver"
                    Budget="@money.Finance"/>
            }
            
            <ActivityCard
                Class="grid-column-sm-full"
                Title="@L["Statistics:Daily"]"
                Activities="@profile.Daily"
                DateFormat="dd MMM"/>

            @if (profile.Monthly.Length > 1)
            {
                <ActivityCard
                    Class="grid-column-full"
                    Title="@L["Statistics:Monthly"]"
                    Activities="@profile.Monthly"
                    DateFormat="MMM yyyy"/>
            }
        </EduFillGrid>
    </EduContainer>
</ApiViewer>

@code {
    private ApiResult<StatisticsModel> _result = ApiResult<StatisticsModel>.Loading();

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["History_Title"].Value, HistoryUrl.Root),
        new BreadcrumbItem(L["Shared_UserProfile"].Value, HistoryUrl.User.MyProfile)
    };

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryUserService UserService { get; set; } = default!;

    protected override async Task OnInitializedAsync() =>
        _result = await UserService.GetStatisticsAsync();

}