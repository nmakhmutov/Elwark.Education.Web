@using Education.Web.Client.Pages.History.Components
@inherits LayoutComponentBase

<HistorySettingsProvider>
    <MudLayout>
        <HistoryAppBar DrawerToggleCallback="@ToggleDrawerAsync"/>
        <HistoryDrawer DrawerOpen="@_isOpen" OnDrawerOpenChanged="@OnDrawerOpenChanged"/>

        @Body

        <MudScrollToTop TopOffset="400">
            <MudFab Icon="@Icons.Material.Outlined.KeyboardArrowUp" Color="Color.Primary"/>
        </MudScrollToTop>
    </MudLayout>
</HistorySettingsProvider>

@code {
    private bool _isOpen;

    [CascadingParameter]
    private AppSettingsProvider AppSettings { get; set; } = default!;

    protected override void OnParametersSet() =>
        _isOpen = AppSettings.IsSidebarOpen;

    private ValueTask ToggleDrawerAsync() =>
        OnDrawerOpenChanged(!_isOpen);

    private ValueTask OnDrawerOpenChanged(bool value) =>
        AppSettings.ToggleSidebarAsync(_isOpen = value);

}