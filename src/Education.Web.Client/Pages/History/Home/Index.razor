@using Education.Web.Client.Pages.History.Components
@using Education.Web.Client.Pages.History.Home.Components
@using Education.Web.Client.Services.History.Trend.Model
@using Education.Web.Client.Services.History.Trend

@page "/history"
@layout HistoryLayout

<PageTitle>@L["Subject:History"]</PageTitle>
<EduPage>
    <ApiViewer Result="@_result" Context="result">
        <SpotlightGrid Class="mb-3 mb-sm-6" Topics="@result.Trends.Take(8).ToArray()"/>

        <EduContainer Class="mb-3 mb-sm-6" MaxWidth="@EduWidth.W1600">
            <div class="header">
                <h2>@L["History:Epochs"]</h2>
            </div>
            <EpochSlider/>
        </EduContainer>

        <EduContainer Class="mb-3 mb-sm-6" MaxWidth="@EduWidth.W1600">
            <div class="header">
                <h2>@L["Topics:Trending"]</h2>
            </div>
            <section class="four-column">
                @foreach (var item in result.Trends.Skip(8))
                {
                    <TopicCard
                        Epoch="@item.Epoch"
                        Id="@item.Id"
                        Overview="@item.Overview"
                        Rating="@item.Rating"
                        Title="@item.Title"
                        Image="@item.ThumbnailUrl"/>
                }
            </section>
        </EduContainer>

        <EduContainer Class="mb-3 mb-sm-6 grey darken-4" MaxWidth="@EduWidth.W1280">
            <DailyTopic Topic="@result.DailyTopic" Class="my-6 my-sm-12"/>
        </EduContainer>

        <EduContainer Class="mb-3 mb-sm-6" MaxWidth="@EduWidth.W1600">
            <div class="two-column">
                <section>
                    <div class="header">
                        <h2>@L["Topics:Recent"]</h2>
                    </div>
                    @for (var i = 0; i < result.Recent.Length; i++)
                    {
                        var item = result.Recent[i];

                        <TopicCard
                            Id="@item.Id"
                            Epoch="@item.Epoch"
                            Title="@item.Title"
                            Image="@item.ThumbnailUrl"
                            Overview="@item.Overview"
                            Rating="@item.Rating"
                            Horizontal
                            Class="@(i == result.Recent.Length - 1 ? null : "mb-3 mb-sm-6")"/>
                    }
                </section>

                <section>
                    <div class="header">
                        <h2>@L["Topics:TopFavorites"]</h2>
                    </div>

                    <EduFitGrid>
                        @foreach (var item in result.TopFavorites)
                        {
                            <TopicCard
                                Id="@item.Id"
                                Epoch="@item.Epoch"
                                Title="@item.Title"
                                Image="@item.ThumbnailUrl"
                                Overview="@item.Overview"
                                Rating="@item.Rating"/>
                        }
                    </EduFitGrid>
                </section>
            </div>
        </EduContainer>

        <EduContainer Class="mb-3 mb-sm-6" MaxWidth="@EduWidth.W1600">
            <div class="header">
                <h2>@L["Topics:TopRatings"]</h2>
            </div>

            <section class="four-column">
                @foreach (var item in result.TopRatings)
                {
                    <TopicCard
                        Id="@item.Id"
                        Epoch="@item.Epoch"
                        Title="@item.Title"
                        Image="@item.ThumbnailUrl"
                        Overview="@item.Overview"
                        Rating="@item.Rating"/>
                }
            </section>
        </EduContainer>

        <EduContainer Class="mb-3 mb-sm-6" MaxWidth="@EduWidth.W1600">
            <RandomTopic Class="my-6 my-sm-12"/>
        </EduContainer>

    </ApiViewer>
</EduPage>

@code {
    private ApiResult<HistoryOverviewModel> _result = ApiResult<HistoryOverviewModel>.Loading();

    [Inject]
    private IHistoryTrendService HistoryTrendService { get; set; } = default!;

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    protected override async Task OnInitializedAsync() =>
        _result = await HistoryTrendService.GetAsync();

}