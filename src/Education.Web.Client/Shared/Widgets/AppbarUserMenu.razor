@using Education.Web.Client.Features.Authentication
@using Education.Web.Client.Features.Customer
<AuthorizeView>
    <NotAuthorized>
        <MudButton
            Class="ml-3"
            Variant="Variant.Filled"
            Color="Color.Primary"
            Size="Size.Small"
            OnClick="@OnLogin"
            DisableElevation>
            @L["Account_SignIn"]
        </MudButton>
    </NotAuthorized>

    <Authorizing>
        <MudSkeleton Class="ml-3" SkeletonType="SkeletonType.Circle" Width="40px" Height="40px"/>
    </Authorizing>

    <Authorized>
        <MudMenu Class="ml-3" Direction="Direction.Left" OffsetX Dense>
            <ActivatorContent>
                <img class="avatar rounded-circle object-cover object-center" src="@Customer.Image" alt="@Customer.Name" loading="lazy"/>
            </ActivatorContent>

            <ChildContent>
                <section class="container d-flex flex-column align-center gap-3 pa-3 pa-sm-6">
                    <img class="image rounded-circle object-cover object-center" src="@Customer.Image" alt="@Customer.Name" loading="lazy"/>

                    <MudText Class="one-line-text" Typo="Typo.h5" Align="Align.Center">
                        @L["HiUserName_Title", Customer.Name]
                    </MudText>

                    <MudFab
                        Class="text-transform-none"
                        Color="Color.Default"
                        Size="Size.Small"
                        Href="@Configuration["Urls:Account"]"
                        Target="_blank"
                        Label="@L["ManageYourElwarkAccount_Title"]"
                        DisableRipple
                        DisableElevation/>

                    <MudButtonGroup Color="Color.Primary" Variant="Variant.Text" Size="Size.Large" DisableElevation>
                        <MudButton StartIcon="@Icons.Material.Outlined.Person" Href="@CustomerUrl.Root" DisableRipple>
                            @L["Account_Title"]
                        </MudButton>
                        <MudButton StartIcon="@Icons.Material.Outlined.Login" OnClick="@OnLogout" DisableRipple>
                            @L["Account_Logout"]
                        </MudButton>
                    </MudButtonGroup>
                </section>
            </ChildContent>
        </MudMenu>
    </Authorized>
</AuthorizeView>

@code {

    [Inject]
    private IStringLocalizer<App> L { get; init; } = default!;

    [Inject]
    private NavigationManager Navigation { get; init; } = default!;

    [Inject]
    private IConfiguration Configuration { get; init; } = default!;

    [CascadingParameter]
    private CustomerState Customer { get; init; } = default!;

    private void OnLogin() =>
        Navigation.NavigateToLogin(AuthenticationUrl.LogIn(Navigation.Uri));

    private void OnLogout() =>
        Navigation.NavigateToLogout(AuthenticationUrl.LogOut);

}