@using ApexCharts

<div class="@Class">
    @if (Value.Questions > 0)
    {
        <ApexChart TItem="Data" Options="@Options">
            <ApexRangeSeries
                TItem="Data"
                Items="@Series"
                XValue="@(x => x.Name)"
                YValue="@(x => x.Value)"/>
        </ApexChart>
    }

    <ChartList Items="@Items"/>
</div>

@code {

    private ApexChartOptions<Data> Options => new()
    {
        PlotOptions = new PlotOptions
        {
            Bar = new PlotOptionsBar
            {
                Horizontal = true
            }
        },
        Tooltip = new Tooltip
        {
            Enabled = false
        },
        Chart = new Chart
        {
            Toolbar = new Toolbar
            {
                Show = false
            },
            Background = "transparent",
            ForeColor = "var(--mud-palette-text-primary)"
        },
        Colors = new List<string>
        {
            Colors.Blue.Default,
            Colors.DeepPurple.Default,
            Colors.Green.Accent4,
            Colors.Red.Default
        }
    };

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Parameter, EditorRequired]
    public AnswerRatioModel Value { get; set; } = default!;

    [Parameter]
    public string? Class { get; set; }

    private List<Data> Series => new()
    {
        new Data(L["Questions:Answered"], 0),
        new Data(L["Questions:Answered"], Value.Answered),
        new Data(L["Questions:NotAnswered"], 0),
        new Data(L["Questions:NotAnswered"], Value.NotAnswered),
        new Data(L["Questions:Correct"], 0),
        new Data(L["Questions:Correct"], Value.Correct),
        new Data(L["Questions:Incorrect"], 0),
        new Data(L["Questions:Incorrect"], Value.Incorrect)
    };

    private ChartList.Item[] Items => new[]
    {
        new ChartList.Item(L["Questions:Answered"], Value.Answered, Colors.Blue.Default),
        new ChartList.Item(L["Questions:NotAnswered"], Value.NotAnswered, Colors.DeepPurple.Default),
        new ChartList.Item(L["Questions:Correct"], Value.Correct, Colors.Green.Accent4),
        new ChartList.Item(L["Questions:Incorrect"], Value.Incorrect, Colors.Red.Default),
        new ChartList.Item(L["Questions:Total"], Value.Questions, null)
    };

    private sealed record Data(string Name, uint Value);

}
