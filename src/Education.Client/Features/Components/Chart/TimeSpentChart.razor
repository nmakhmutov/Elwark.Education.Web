@using ApexCharts

<div class="@Class">
    <ApexChart TItem="Data" Options="@Options">
        <ApexPointSeries
            TItem="Data"
            Items="@Series"
            SeriesType="SeriesType.RadialBar"
            XValue="@(x => x.Name)"
            YAggregate="@(x => x.Sum(e => e.Value))"/>
    </ApexChart>

    <ChartList Items="@Items"/>
</div>

@code {

    private static readonly ApexChartOptions<Data> Options = new()
    {
        PlotOptions = new PlotOptions
        {
            RadialBar = new PlotOptionsRadialBar
            {
                DataLabels = new RadialBarDataLabels
                {
                    Show = true,
                    Value = new RadialBarDataLabelsValue
                    {
                        Formatter = @"function(value) { return new Date(value * 1000).toISOString().substr(11, 8) }"
                    }
                }
            }
        },
        Legend = new Legend
        {
            Show = false
        },
        Colors = new List<string>
        {
            Colors.Green.Accent4,
            Colors.Blue.Default,
            Colors.DeepPurple.Default
        }
    };

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public TimeSpent Value { get; set; } = default!;

    private ChartList.Item[] Items => new[]
    {
        new ChartList.Item(L["TimeSpent:Min"], Value.Min, Colors.Green.Accent4),
        new ChartList.Item(L["TimeSpent:Max"], Value.Max, Colors.Blue.Default),
        new ChartList.Item(L["TimeSpent:Average"], Value.Average, Colors.DeepPurple.Default),
        new ChartList.Item(L["TimeSpent:Total"], Value.Total, null)
    };

    private Data[] Series => new[]
    {
        new Data(L["TimeSpent:Min"], (decimal)Value.Min.TotalSeconds),
        new Data(L["TimeSpent:Max"], (decimal)Value.Max.TotalSeconds),
        new Data(L["TimeSpent:Average"], (decimal)Value.Average.TotalSeconds)
    };

    private record Data(string Name, decimal Value);

}
