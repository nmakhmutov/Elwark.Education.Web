@page "/history/my/achievements"
@layout HistoryLayout

@using Education.Client.Gateways.History
@using Education.Client.Features.History.My.Components
@using Education.Client.Gateways.History.Me

@attribute [Authorize]

<PageTitle>@L["Achievements"]</PageTitle>

<ApiViewer Response="@_response">
    <Loading>
        <PageSpinner/>
    </Loading>

    <Success Context="statistics">
        <MainContainer>
            <PageHeader Title="@L["Achievements"]" Class="mb-3 mb-sm-6" Breadcrumbs="@Breadcrumbs"/>
            @foreach (var statistic in statistics)
            {
                <MudText Typo="Typo.h5" Class="mb-3">
                    @L[$"AchievementCategory:{statistic.Category}"]
                    <MudText Typo="Typo.subtitle1" Inline="true">
                        @statistic.Completed/@statistic.Total
                    </MudText>
                </MudText>
                <div class="grid mb-6 mb-sm-12">
                    @foreach (var achievement in statistic.Achievements)
                    {
                        <AchievementView Achievement="@achievement"/>
                    }
                </div>
            }
        </MainContainer>
    </Success>
</ApiViewer>


@code {

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["Account"].Value, Links.Account.Index),
        new BreadcrumbItem(L["Profile"].Value, Links.History.MyProfile)
    };

    private ApiResponse<AchievementStatistics[]> _response = ApiResponse<AchievementStatistics[]>.Loading();

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryClient HistoryClient { get; set; } = default!;

    protected override async Task OnParametersSetAsync() =>
        _response = await HistoryClient.User.GetAchievementsAsync();

}
