@page "/history/my/achievements"
@layout HistoryLayout

@using Education.Client.Gateways.History
@using Education.Client.Features.History.My.Components
@using Education.Client.Gateways.History.Me

@attribute [Authorize]

<PageTitle>@L["Achievements"]</PageTitle>
<MainContainer>
    <PageHeader Title="@L["Achievements"]" Class="mb-3 mb-sm-6" Breadcrumbs="@Breadcrumbs"/>
    <ApiViewer Response="@_response">
        <Loading>
            <div class="grid mb-3 mb-sm-6">
                <SkeletonCard/>
                <SkeletonCard/>
                <SkeletonCard/>
                <SkeletonCard/>
            </div>
        </Loading>

        <Success Context="statistics">
            @foreach (var statistic in statistics)
            {
                <MudText Typo="Typo.h6" Class="mb-3">
                    @L[$"AchievementCategory:{statistic.Category}"] <MudText Typo="Typo.subtitle1" Inline="true">@statistic.Completed/@statistic.Total</MudText>
                </MudText>
                <div class="grid mb-6 mb-sm-12">
                    @foreach (var achievement in statistic.Achievements)
                    {
                        <AchievementView Achievement="@achievement" ShowDescription="true"/>
                    }
                </div>
            }
        </Success>
    </ApiViewer>
</MainContainer>

@code {

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["Account"].Value, Links.Account.Index),
        new BreadcrumbItem(L["Profile"].Value, Links.History.MyProfile)
    };

    private ApiResponse<AchievementStatistics[]> _response = ApiResponse<AchievementStatistics[]>.Loading();

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryClient HistoryClient { get; set; } = default!;

    protected override async Task OnParametersSetAsync() =>
        _response = await HistoryClient.Me.GetAchievementsAsync();

}
