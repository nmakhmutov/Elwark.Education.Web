@page "/history/my/statistics"
@layout HistoryLayout

@attribute [Authorize]

@using Education.Client.Gateways.History.Me
@using Education.Client.Gateways.History
@using Education.Client.Features.History.My.Statistics.Components;

<PageTitle>@L["Statistics"]</PageTitle>
<MainContainer>
    <PageHeader Title="@L["Statistics"]" Class="mb-3 mb-sm-6" Breadcrumbs="@Breadcrumbs"/>
    <ApiViewer Response="@_response">
        <Loading>
            <SkeletonCard Class="mb-3 mb-sm-6"/>
            <SkeletonCard />
        </Loading>
        <Success Context="activity">
            <ActivityCard
                Class="mb-3 mb-sm-6"
                Title="@L["Statistics:Daily"]"
                Activities="@activity.Daily"
                DateFormat="dd MMM"/>

            @if (activity.Monthly.Length > 1)
            {
                <ActivityCard
                    Class="monthly"
                    Title="@L["Statistics:Monthly"]"
                    Activities="@activity.Monthly"
                    DateFormat="MMM yyyy"/>
            }
        </Success>
    </ApiViewer>
</MainContainer>

@code {

    private List<BreadcrumbItem> Breadcrumbs => new()
    {
        new BreadcrumbItem(L["Account"].Value, Links.Account.Index),
        new BreadcrumbItem(L["Profile"].Value, Links.History.MyProfile)
    };

    private ApiResponse<ActivityStatistics> _response = ApiResponse<ActivityStatistics>.Loading();

    [Inject]
    private IStringLocalizer<App> L { get; set; } = default!;

    [Inject]
    private IHistoryClient HistoryClient { get; set; } = default!;

    protected override async Task OnParametersSetAsync() =>
        _response = await HistoryClient.Me.GetActivitiesAsync();

}
